<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html ng-app="huewi" xmlns='http://www.w3.org/1999/xhtml'>
<head>
  <title>hue Web Interface</title>
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
  <meta name='viewport' content='width=device-width' />

  <meta name='mobile-web-app-capable' content='yes' />
  <meta name='mobile-web-app-title' content='huewi' />
  <meta name='apple-mobile-web-app-title' content='huewi' />
  <meta name='apple-mobile-web-app-capable' content='yes' />
  <meta name='apple-mobile-web-app-status-bar-style' content='black' />

  <!--script src='http://requirejs.org/docs/release/2.1.16/minified/require.js' type='text/javascript' ></script-->
  <script src='http://code.jquery.com/jquery-1.11.2.min.js' type='text/javascript' ></script>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <!--link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css"-->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

  <script src="http://underscorejs.org/underscore-min.js" type="text/javascript"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js" type="text/javascript"></script>

  <script src='https://arndbrugman.github.io/huepi/huepi.js' type='text/javascript'></script>
<!--script src='../huepi/huepi.js' type='text/javascript'></script-->

  <script src="js/app.js" type="text/javascript"></script>

  <!--script src='js/cordova.js' type='text/javascript' onload="javascript:window.isCordovaApp = true;"></script-->

  <style type='text/css'>
  html, body {
    width: 100%;
    height: 100%;
    background: #202830;
  }
  .status {
    position: fixed;
    left: 0px;
    bottom: 0px;
    height: auto;
    width: 100%;
    text-align: center;
    background: #aaaace;
    color: #303840;
  }
  h3 {
    color: #aaaace;
    text-align: center;
    margin-bottom: 8px;
  }
  .list-group-item {
    left: 0px;
    bottom: 0px;
    height: auto;
    width: 100%;
    background: #404860;
    color: #c0c8e0;
  }
  button {
    background: #404860;
    color: #aaaace;
  }
  @media screen and (orientation:landscape) {
    .container {
      float: left;
      width: 50%;
      height: 100%;
    }
  }
  @media screen and (orientation:portrait) {
    .container {
      float: left;
      width: 100%;
      height: auto;
    }
  }
  .content { }
  .left {
    float: left;
  }
  .right {
    float: right;
  }
  .grayed {
    background: #101820;
    color: #606870;
  }
  .mainmenu
  {
    position: fixed;
    right: 0px;
    top: 0px;
    z-index: 999;
  }
  </style>
</head>
<body id='HueStatusController' ng-controller='HueStatusController as HueStatusCtrl'>
  <script type='text/javascript' >
  var HeartbeatInterval;
  var PrevStatus;
  if (window.isCordovaApp) {
    document.addEventListener("deviceready", onStartup, false);
    document.addEventListener("pause", onPause, false);
    document.addEventListener("resume", onResume, false);
  } else
  $(document).ready(onStartup);
  function onStartup() {

    onResume();
    function Redraw() {
    };
    window.onload = function() {
      window.onresize();
    };
    window.onresize = function() {
      Redraw();
    };
    $("#window").click(function(event) {
    });
  }

  function onResume() {
    angular.element(document.getElementById('HueStatusController')).controller().ConnectToHueBridge();
    HeartbeatInterval = window.setInterval(StatusHeartbeat, 2500);
      StatusHeartbeat(); // Execute Immediate Too!
    }

    function onPause() {
      window.clearInterval(HeartbeatInterval);
      $('#HueStatusbar').show(500);
    }

    function StatusHeartbeat() {
      if ((PrevStatus != angular.element(document.getElementById('HueStatusController')).controller().Status) &
        (angular.element(document.getElementById('HueStatusController')).controller().Status === 'Connected'))
      {
        $('#HueStatusbar').slideUp(1500);
      }
      PrevStatus = angular.element(document.getElementById('HueStatusController')).controller().Status;
      angular.element(document.getElementById('HueStatusController')).controller().MyHue.BridgeGetData().then(function UpdateUI() {
        angular.element(document.getElementById('Groups')).controller().Update();
        angular.element(document.getElementById('Lights')).controller().Update();
      }, function BridgetHeartbeatGetFailed() {
        onPause();
        onResume();
      });
    }
    </script>



    <div class='container' id='Groups' ng-controller='GroupController as GroupCtrl'>
      <div class='content'>
        <h3>Groups</h3>
        <div "class=list-group">
          <div class="list-group-item" ng-repeat="Group in GroupCtrl.Groups">
            <span left>{{Group.name}}</span>
            <button type="button" class="btn btn-sm right" ng-click="HueStatusCtrl.MyHue.GroupOff($index);" ng-class="{ hidden: !((Group.action.on) || ($index == 0)) }">
              <span class="glyphicon glyphicon-record" style="color:{{Group.HTMLColor}}" aria-hidden="true"></span>
            </button>

            <button type="button" class="btn btn-sm right" ng-click="HueStatusCtrl.MyHue.GroupOn($index);" ng-class="{ hidden:Group.action.on }">
              <span class="glyphicon glyphicon-certificate" aria-hidden="true"></span>
            </button>

          </div>
        </div>
      </div><!-- /content -->
    </div><!-- /container -->

    <div class='container' id='Lights' ng-controller='LightController as LightCtrl'>
      <div class='content'>
        <h3>Lights</h3>
        <div "class=list-group">
          <div class="list-group-item" ng-repeat="Light in LightCtrl.Lights" ng-class="{ grayed:!Light.state.reachable }">
            <span left>{{Light.name}}</span>
            <span ng-class="{ hidden:!Light.state.reachable }">
              <button type="button" class="btn btn-sm right" ng-click="HueStatusCtrl.MyHue.LightOff($index + 1);" ng-class="{ hidden:!Light.state.on }">
                <span class="glyphicon glyphicon-record" style="color:{{Light.HTMLColor}}" aria-hidden="true"></span>
              </button>
              <button type="button" class="btn btn-sm right" ng-click="HueStatusCtrl.MyHue.LightOn($index + 1);" ng-class="{ hidden:Light.state.on }">
                <span class="glyphicon glyphicon-certificate" aria-hidden="true"></span>
              </button>
            </span>
          </div>
        </div>
      </div><!-- /content -->
    </div><!-- /container -->

    <div class='status'>
      <h4>huewi</h4>
      <!-- Single button -->
      <div id='HueStatusbar'>
        Bridge IP: {{HueStatusCtrl.BridgeIP}} <br>
        Bridge Name: {{HueStatusCtrl.BridgeName}} <br>
        Status: {{HueStatusCtrl.Status}} <br>
      </div>
    </div><!-- /status -->

  </body>
  </html>
